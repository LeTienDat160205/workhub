<!DOCTYPE html>
<html lang="vi" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>WorkHub Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --primary-bg:#F6F8FA;
      --div-bg:#E8F9F1;
      --accent:#FFD6A5;
      --accent-hover:#FFB74D;
      --primary-text:#1E293B;
      --border-color:#DDEBE5;
      --card-bg:#fff;
      --input-bg:#fff;
    }
    [data-theme="dark"]{
      --primary-bg:#1A1528;
      --div-bg:#23203A;
      --accent:#B388FF;
      --accent-hover:#9D4EDD;
      --primary-text:#EDE9FE;
      --border-color:#2E1F46;
      --card-bg:#2E1F46;
      --input-bg:#2E1F46;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0}
    body{
      min-height:100vh;height:100vh;width:100vw;
      font-family:"Segoe UI",Arial,sans-serif;
      background:var(--primary-bg);color:var(--primary-text);
      overflow:hidden;position:relative;transition:background .3s,color .3s;
    }
    .dashboard-frame{
      position:absolute;inset:0;width:100vw;height:100vh;margin:0;margin-top:5px;border-radius:5px;border:none;
      display:flex;flex-direction:column;overflow:hidden;z-index:1;animation:fadeInDash .7s;
    }
    @keyframes fadeInDash{from{opacity:0;transform:scale(1.03)}to{opacity:1;transform:scale(1)}}

    /* HEADER */
    .dashboard-header{
      display:grid;grid-template-columns:180px auto;gap:12px;align-items:center;
      padding:16px 32px 12px 32px;border-bottom:1.5px solid #e5e7eb;background:rgba(255,255,255,.92);
      box-shadow:0 2px 16px #2563eb11;position:relative;z-index:10;border-radius:5px;margin:10px;
      transition:background .3s;
    }
    [data-theme="dark"] .dashboard-header{background:rgba(35,41,70,.98)}
    .logo-bar{display:flex;align-items:center;gap:14px;min-width:140px}
    .site-name{font-size:35px;font-weight:900;color:lightgreen;letter-spacing:1.5px;text-shadow:0 2px 12px #c4b5fd55,0 1px 0 #fff}
    .header-actions{justify-self:end;display:flex;align-items:center;gap:16px}
    .icon-btn{
      background:var(--accent);color:var(--primary-text);border:none;border-radius:8px;cursor:pointer;
      padding:10px;display:flex;align-items:center;justify-content:center;line-height:0;
      box-shadow:0 2px 8px #00000011;transition:background .2s,color .2s
    }
    .icon-btn:hover{background:var(--accent-hover);color:var(--primary-text)}
    .icon-btn svg{width:20px;height:20px}

    .user-account{display:flex;align-items:center;gap:10px;cursor:pointer;font-weight:700;margin-left:10px;margin-right:-15px;font-size:1.05rem;color:#222;padding:4px 18px 4px 8px;border-radius:16px;background:#f3f4fa;border:none;box-shadow:none;position:relative;}
    .user-avatar{width:36px;height:36px;border-radius:50%;background:#c7d2fe;display:flex;align-items:center;justify-content:center;font-size:1.1rem;color:#2563eb;font-weight:700;border:2px solid #2563eb33;box-shadow:0 2px 8px #2563eb22}

    /* BODY */
    .dashboard-body{flex:1;display:flex;min-height:0;height:0;background:transparent}

    /* SIDEBAR */
    .sidebar{
      width:240px;border-right:1.5px solid #e5e7eb;border-radius:5px;background:rgba(255,255,255,.92);
      display:flex;flex-direction:column;padding:24px 0 56px;position:relative;box-shadow:0 2px 12px #2563eb11;z-index:1;
      margin:5px 0 10px 10px;height:97%;min-height:0;transition:background .3s;
    }
    [data-theme="dark"] .sidebar{background:rgba(35,41,70,.98)}
    .sidebar-section{flex:1;display:flex;flex-direction:column;min-height:0}
    .sidebar-search{margin:-15px 16px 14px 24px;border-radius:5px;overflow:hidden;background:#f8fafc}
    .mini-pill{
      height:36px;border-radius:5px;border:1.5px solid #e5e7eb;background:#f1f5ff;display:flex;align-items:center;padding:0 14px;gap:8px;
      box-shadow:0 1px 0 #ffffff,0 1px 0 #eef2ff
    }
    .mini-pill svg{width:18px;height:18px;opacity:.8}
    .mini-pill input{border:0;outline:0;background:transparent;width:100%;color:inherit;font-size:1rem}
    .sidebar-list{
      flex:1;min-height:0;margin:0 16px 0 20px;max-height:450px;overflow-y:auto;background:#f8fafc;border-radius:5px;border:1px solid #e5e7eb;box-shadow:0 1px 8px #2563eb11;padding:0;
    }
    .sidebar-list::-webkit-scrollbar{width:8px;background:#e0e7ff;border-radius:5px}
    .sidebar-list::-webkit-scrollbar-thumb{background:#c7d2fe;border-radius:5px}

    /* MAIN */
    .main-content{flex:1;display:flex;flex-direction:column;min-width:0;background:transparent}
    .main-toolbar{
      display:flex;align-items:center;gap:10px;margin:5px 10px 0 10px;padding:16px 18px;border-bottom:1.5px solid #e5e7eb;
      background:var(--accent);color:var(--primary-text);border-radius:12px;box-shadow:0 2px 8px #00000011;margin-bottom:18px;transition:background .3s,color .3s;
    }
    [data-theme="dark"] .main-toolbar{background:var(--accent);color:var(--primary-text)}
    .task-tabs{background:#e0e7ff;border-radius:5px;overflow:hidden;display:flex;gap:0;padding:2px}
    .tab-btn{
      padding:8px 22px;border:none;background:none;font-weight:700;cursor:pointer;font-size:1rem;color:#ebca25ac;border-right:none;outline:none;
      display:flex;align-items:center;gap:6px;border-radius:5px;min-width:90px
    }
    .tab-btn.active{background:linear-gradient(90deg,#22c589,#22c589);color:#000;box-shadow:0 2px 8px #2563eb22;border-radius:5px}
    .tab-btn:not(.active):hover{background:#f3f0ff;color:#ebc325ac}
    .tab-btn svg{width:18px;height:18px;stroke:currentColor;stroke-width:2;fill:none}

    .search-pill{flex:1;height:44px;border-radius:5px;border:none;background:#f1f5ff;display:flex;align-items:center;padding:0 18px;gap:12px;margin-left:18px}
    .search-pill svg{width:20px;height:20px;opacity:.9}
    .search-pill input{width:100%;border:0;outline:0;background:transparent;font-size:1.05rem;color:inherit}

    .filter-select{margin-left:18px;height:44px;min-width:100px;font-size:16px;border-radius:5px;border:1.5px solid #2563eb;background:#fff;color:#8525eb;font-weight:600;transition:border-color .18s,background .18s;box-shadow:none;padding:0 5px}
    .filter-select:focus{border-radius:5px;border-color:#4d25eb;outline:none;background:#e0e7ff}

    .content-task{
      flex:1;overflow-y:auto;margin:-5px 10px 12px 10px;border-radius:5px;border:1px solid #e5e7eb;background:#f9edda;min-height:300px;box-shadow:0 1px 8px #2563eb11;color:#524041;
    }

    /* RIGHT PANEL STACK */
    .right-panel-stack{position:fixed;top:84px;right:0;height:calc(100vh - 84px);width:420px;max-width:100vw;z-index:20;display:flex;flex-direction:column;pointer-events:none}
    .right-panel.half{
      width:100%;height:0;background:#fff;border-left:2px solid #e5e7eb;border-radius:5px;overflow:hidden;opacity:0;pointer-events:none;
      transition:height .4s cubic-bezier(.7,0,.3,1),opacity .3s,transform .45s cubic-bezier(.7,0,.3,1);display:flex;flex-direction:column;position:relative;transform:translateX(100%);
      box-shadow:0 8px 32px rgba(49,130,206,.18),0 2px 12px rgba(49,130,206,.09)
    }
    .right-panel.half.show{height:50%;opacity:1;pointer-events:auto;transform:translateX(0)}
    .right-panel.half.top{z-index:2;border-bottom:1.5px solid #e5e7eb}
    .right-panel.half.bottom{z-index:1;border-top:1.5px solid #e5e7eb}

    .panel-head{display:flex;align-items:center;justify-content:space-between;background:#f1f5ff;border-bottom:1.5px solid #e5e7eb;padding:13px 18px 11px 18px;font-size:1.08rem;font-weight:700;color:#a925eb;letter-spacing:.5px;box-shadow:0 2px 8px #2563eb11}
    .panel-title{display:flex;align-items:center;font-size:1.08rem;font-weight:700;color:var(--accent);letter-spacing:.5px;gap:4px}
    .close-panel{background:none;border:none;font-size:24px;color:var(--accent);cursor:pointer;border-radius:5px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:background .18s,color .18s}
    .close-panel:hover{background:#e0e7ff;color:#ef4444}
    .right-section{flex:1;overflow-y:auto;background:#f8fafc;padding:0;display:flex;flex-direction:column}
    .notif-list{padding:0;margin:0;display:flex;flex-direction:column;gap:12px}
    .notif-item{display:flex;align-items:center;gap:12px;padding:13px 18px;background:#fff;border-radius:5px;margin:0 6px;box-shadow:0 2px 8px #2563eb11;min-height:48px;position:relative;font-size:1.05rem;font-weight:600;color:var(--accent);border:1.5px solid #e5e7eb}
    .notif-item:hover{background:#e0e7ff;box-shadow:0 4px 16px #2563eb22}
    .notif-dot{width:18px;height:18px;border-radius:5px;border:2px solid #cbd5e1;background:#fff;flex-shrink:0;margin-right:4px;display:flex;align-items:center;justify-content:center}
    .notif-dot::after{content:"";display:block;width:8px;height:8px;background:#60a5fa;border-radius:5px;margin:auto}

    /* Calendar mini */
    .calendar-card{background:#fff;border-radius:0;box-shadow:none;margin:0;padding:0;border:none;display:flex;flex-direction:column}
    .calendar-head{padding:10px 16px 6px 16px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between;background:#f8fafc}
    .calendar-title{font-weight:800;color:var(--accent);font-size:1.02rem;letter-spacing:.5px}
    .calendar-sub{font-size:12px;color:#6b7280;letter-spacing:1px}
    .calendar-head .btn{min-width:32px;height:32px;padding:0;font-size:1.1rem;border-radius:8px}
    .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;padding:8px 8px 10px 8px;background:#fff}
    .calendar-grid .dow{height:22px;border:0;background:transparent;font-weight:700;color:#64748b;display:flex;align-items:center;justify-content:center;font-size:.93rem}
    .calendar-grid .cell{height:28px;border-radius:5px;display:flex;align-items:center;justify-content:center;border:1px solid #eef2f7;background:#f9fafb;color:#0f172a;font-size:.93rem;font-weight:500;transition:background .18s,color .18s;cursor:pointer}
    .calendar-grid .cell.faded{opacity:.45;background:#e0e7ff;color:#64748b}
    .calendar-grid .cell.today{outline:2px solid var(--accent);outline-offset:-2px;font-weight:700;background:#dbeafe;color:#2563eb}
    .calendar-grid .cell:hover:not(.faded){background:#e0e7ff;color:#2563eb}

    /* POPUP chung */
    .popup-overlay{display:none;position:fixed;inset:0;background:rgba(49,130,206,.10);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(2px)}
    .popup-overlay.active{display:flex}
    .popup-content{
      width:420px;background:rgba(255,255,255,.98);border-radius:12px;box-shadow:0 12px 48px rgba(49,130,206,.16),0 2px 12px rgba(49,130,206,.09);
      padding:36px 32px 28px 32px;position:relative;animation:fadeInUp .35s;border:1.5px solid #e0e7ff;overflow:hidden;display:flex;flex-direction:column
    }
    .popup-content::before{content:"";position:absolute;top:-60px;right:-60px;width:140px;height:140px;background:radial-gradient(circle,#60a5fa33 60%,transparent 100%);z-index:0}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .close-btn{background:none;border:none;font-size:28px;color:#888;cursor:pointer;transition:color .2s,transform .2s;position:absolute;top:16px;right:22px;z-index:2}
    .close-btn:hover{color:#ef4444;transform:rotate(90deg) scale(1.15)}
    .popup-title{font-size:1.3rem;font-weight:700;color:var(--accent);letter-spacing:1px;text-shadow:0 2px 12px #c7d2fe55,0 1px 0 #fff;margin-bottom:18px}

    .btn{background:var(--accent);color:var(--primary-text);border:none;border-radius:8px;font-weight:700;box-shadow:0 2px 8px #00000011;transition:background .2s,color .2s;padding:8px 12px;cursor:pointer}
    .btn:hover{background:var(--accent-hover);color:var(--primary-text)}
    #editProfileBtn,#saveProfileBtn{background:#9f25eb;color:#fff;border-radius:8px;border:none;min-width:90px;font-size:15px;padding:8px 12px}
    #editProfileBtn:hover,#saveProfileBtn:hover{filter:brightness(1.05)}

    .form-label{color:var(--primary-text)!important}
    .form-input,select.form-input{background:var(--input-bg);color:var(--primary-text);border:1.5px solid var(--border-color);border-radius:8px;font-size:15px;transition:background .2s,color .2s,border-color .2s}

    /* ===== NÚT UIVERSE CHO "TẠO NHÓM" ===== */
    .cssbuttons-io-button{
      background:var(--accent);
      color:var(--primary-text);
      font-family:inherit;
      padding:.35em 1.2em;
      font-size:16px;
      font-weight:700;
      border-radius:12px;
      border:none;
      letter-spacing:.02em;
      display:flex;
      align-items:center;
      box-shadow:inset 0 0 1.6em -0.6em #00000022;
      overflow:hidden;
      position:absolute;
      left:18px; right:18px; bottom:18px;
      height:48px;
      padding-right:3.3em;
      cursor:pointer;
      transition:background .2s,color .2s;
    }
    .cssbuttons-io-button .icon{
      background:#fff;
      margin-left:1em;
      position:absolute;
      display:flex;align-items:center;justify-content:center;
      height:2.2em;width:2.2em;border-radius:10px;
      box-shadow:0.1em 0.1em 0.6em 0.2em #0000001a;
      right:.3em; transition:all .3s;
    }
    .cssbuttons-io-button:hover .icon{ width:calc(100% - .6em) }
    .cssbuttons-io-button .icon svg{ width:1.1em; transition:transform .3s; color:#7b52b9 }
    .cssbuttons-io-button:hover .icon svg{ transform:rotate(90deg) scale(1.1) }
    .cssbuttons-io-button:active .icon{ transform:scale(.95) }
    [data-theme="dark"] .cssbuttons-io-button .icon{ background:var(--card-bg) }

    /* Menu bộ lọc (dropdown demo) */
    .task-menu{list-style:none;padding:0;margin:0;background:#fff;border:1px solid #e0e0e0;display:inline-block;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .task-menu>li{position:relative}
    .task-menu>li>button{display:block;padding:12px 18px;color:#1e293b;background:none;border:none;font-weight:600;cursor:pointer}
    .task-menu>li>button::after{content:"▼";font-size:.6rem;margin-left:6px;transition:transform .3s}
    .task-menu>li:hover>button{background:#E8F9F1;color:#524041}
    .task-menu>li:hover>button::after{transform:rotate(180deg)}
    .task-sub{position:absolute;left:0;top:100%;list-style:none;margin:0;padding:5px 0;background:#fff;border:1px solid #ddebe5;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.08);opacity:0;visibility:hidden;transform:translateY(5px);transition:all .25s ease;min-width:180px;z-index:10}
    .task-menu>li:hover .task-sub{opacity:1;visibility:visible;transform:translateY(0)}
    .task-sub li button{display:block;padding:10px 16px;color:#1e293b;text-align:left;width:100%;background:none;border:0;font-weight:600;cursor:pointer}
    .task-sub li button:hover{background:#FFD6A5;color:#1e293b}

    /* ====== WORKHUB SETTINGS (namespaced .wh-*) ====== */
    .wh-settings{position:fixed;inset:0;background:#0b1220;color:#e5e7eb;z-index:9999;overflow:hidden;display:none}
    .wh-wrap{display:flex;height:100%}
    .wh-side{width:260px;background:#111827;padding:16px 0;overflow-y:auto}
    .wh-search{padding:0 16px 10px}
    .wh-search input{width:100%;padding:8px 10px;border-radius:6px;border:none;outline:none;background:#1f2937;color:#e5e7eb}
    .wh-group{font-size:.8rem;color:#9ca3af;padding:8px 16px 4px}
    .wh-nav{display:flex;flex-direction:column}
    .wh-nav-item{background:none;border:none;color:#e5e7eb;text-align:left;padding:10px 16px;font-size:.95rem;cursor:pointer;border-left:3px solid transparent;transition:.2s}
    .wh-nav-item:hover{background:#374151}
    .wh-nav-item.wh-active{background:#2563eb22;border-left:3px solid #60a5fa;color:#fff}

    .wh-main{flex:1;display:flex;flex-direction:column;overflow-y:auto;background:#0f172a}
    .wh-topbar{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #374151}
    .wh-title{font-size:1.4rem;font-weight:700;color:#fff}
    .wh-close{background:none;border:none;color:#9ca3af;font-size:22px;cursor:pointer}
    .wh-close:hover{color:#fff}

    .wh-hero{position:relative}
    .wh-hero-bg{height:120px;background:linear-gradient(90deg,#6366f1,#8b5cf6);border-bottom:3px solid #374151}
    .wh-hero-row{display:flex;align-items:center;padding:0 24px;position:relative;top:-40px}
    .wh-ava{width:80px;height:80px;border-radius:50%;border:4px solid #0f172a}
    .wh-hero-info{margin-left:16px;color:#fff}
    .wh-name{font-size:1.3rem;font-weight:700}
    .wh-badges span{margin-right:6px}
    .wh-btn{border:none;border-radius:8px;padding:8px 12px;cursor:pointer;font-weight:600}
    .wh-primary{background:#6366f1;color:#fff}
    .wh-primary:hover{background:#818cf8}
    .wh-secondary{background:#334155;color:#e5e7eb}
    .wh-secondary:hover{background:#475569}
    .wh-danger{background:#ef4444;color:#fff}
    .wh-outline{background:none;border:1px solid #ef4444;color:#ef4444}
    .wh-outline:hover{background:#ef4444;color:#fff}
    .wh-card{background:#1f2937;border-radius:8px;margin:16px 24px;padding:16px 20px;color:#f3f4f6}
    .wh-row{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #374151;padding:10px 0}
    .wh-row:last-child{border:none}
    .wh-label{font-size:.9rem;color:#9ca3af}
    .wh-value{font-weight:600}
    .wh-mini{background:#374151;color:#e5e7eb;border:none;border-radius:6px;padding:6px 10px;cursor:pointer}
    .wh-mini:hover{background:#475569}
    .wh-link{color:#60a5fa;text-decoration:none;font-size:.9rem;margin-left:6px}
    .wh-link:hover{text-decoration:underline}
    .wh-danger-zone{border:1px solid #ef4444}
    .wh-tabs{display:flex;gap:10px;padding:0 24px;margin-top:10px}
    .wh-tab{background:none;border:none;color:#9ca3af;padding:10px 14px;font-weight:600;cursor:pointer}
    .wh-tab.wh-active{color:#fff;border-bottom:2px solid #60a5fa}
    .wh-panel{display:none;padding:0 24px 24px}
    .wh-panel.wh-show{display:block}
    .wh-section{font-size:1.1rem;color:#fff;margin:12px 0}
    .wh-t{font-weight:600}
    .wh-sub{color:#9ca3af}
    .wh-between{justify-content:space-between}
    .wh-pill-ok{background:#16a34a;color:#fff;padding:4px 8px;border-radius:8px;font-size:.9rem}
  </style>
</head>
<body>
  <div class="dashboard-frame">
    <!-- HEADER -->
    <header class="dashboard-header" style="margin-top:0;">
      <div class="logo-bar">
        <span class="site-name">WorkHub</span>
      </div>
      <div class="header-actions actions-cluster">
        <button class="icon-btn" title="Menu" type="button" aria-label="Mở menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <line x1="3" y1="6" x2="21" y2="6" stroke-width="2" />
            <line x1="3" y1="12" x2="21" y2="12" stroke-width="2" />
            <line x1="3" y1="18" x2="21" y2="18" stroke-width="2" />
          </svg>
        </button>
        <button class="icon-btn" id="btnTheme" title="Chuyển chế độ sáng/tối" aria-pressed="false" type="button" aria-label="Chuyển theme">
          <svg id="themeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <circle cx="12" cy="12" r="5" stroke-width="2" />
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke-width="2"/>
          </svg>
        </button>
        <button class="icon-btn" id="btnCalendar" title="Lịch" type="button" aria-controls="calendarPanel" aria-expanded="false" aria-label="Mở lịch">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke-width="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6" stroke-width="2"></line>
            <line x1="8" y1="2" x2="8" y2="6" stroke-width="2"></line>
            <line x1="3" y1="10" x2="21" y2="10" stroke-width="2"></line>
          </svg>
        </button>
        <button class="icon-btn" id="btnNotif" title="Thông báo" type="button" aria-controls="notifPanel" aria-expanded="false" aria-label="Mở thông báo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9" stroke-width="2"></path>
            <path d="M13.73 21a2 2 0 01-3.46 0" stroke-width="2"></path>
          </svg>
        </button>

        <!-- account -->
        <div class="user-account" id="openProfile" title="Account" role="button" aria-haspopup="menu" aria-expanded="false">
          <div style="position:relative;">
            <div style="width:32px;height:32px;border-radius:50%;background:#cbd5e1;display:flex;align-items:center;justify-content:center;"></div>
            <span aria-hidden="true" style="position:absolute;bottom:0;right:-2px;width:10px;height:10px;background:#22c55e;border-radius:50%;border:2px solid #fff;display:block;"></span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-start;">
            <span style="font-weight:700;font-size:1.08rem;color:#222;line-height:1.1;">Tên người dùng</span>
            <span style="font-size:.97rem;color:#64748b;line-height:1.1;">@example.com</span>
          </div>
          <svg style="margin-left:8px;" width="18" height="18" fill="none" stroke="#94a3b8" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 9l6 6 6-6"/></svg>

          <div id="userMenu" style="display:none;position:absolute;top:48px;right:0;min-width:160px;background:#fff;border-radius:10px;box-shadow:0 4px 24px #2563eb22;padding:10px 0;z-index:100;border:1px solid #e5e7eb;" role="menu" aria-label="User menu">
            <button style="width:100%;background:none;border:none;text-align:left;padding:10px 18px;font-size:1rem;color:#2563eb;cursor:pointer;transition:background .15s;" id="Profile" type="button" role="menuitem">Xem thông tin</button>
            <button style="width:100%;background:none;border:none;text-align:left;padding:10px 18px;font-size:1rem;color:#2563eb;cursor:pointer;transition:background .15s;" id="OpenSettings" type="button" role="menuitem">Cài đặt người dùng</button>
            <button style="width:100%;background:none;border:none;text-align:left;padding:10px 18px;font-size:1rem;color:#ef4444;cursor:pointer;transition:background .15s;" id="Logout" type="button" role="menuitem">Đăng xuất</button>
          </div>
        </div>
      </div>
    </header>

    <!-- BODY -->
    <div class="dashboard-body" id="dashboardBody">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <!-- TÌM NHÓM: FORM GET -->
          <form id="groupSearchForm" class="sidebar-search" method="GET" action="/groups" role="search">
            <label for="q" style="display:none;">Tìm nhóm</label>
            <div class="mini-pill">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                <circle cx="11" cy="11" r="7" stroke-width="2"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65" stroke-width="2"></line>
              </svg>
              <input id="q" name="q" type="search" placeholder="Search" />
            </div>
          </form>

          <div class="sidebar-list" id="groupList" role="list"></div>
        </div>

        <!-- NÚT UIVERSE: TẠO NHÓM -->
        <button class="cssbuttons-io-button" id="btnAddGroup" title="Tạo nhóm" type="button" aria-haspopup="dialog" aria-controls="popupGroup">
          Tạo nhóm
          <div class="icon">
            <svg height="24" width="24" viewBox="0 0 24 24" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" fill="none"/>
            </svg>
          </div>
        </button>
      </aside>

      <!-- MAIN -->
      <main class="main-content" id="mainContent">
        <div class="main-toolbar">
          <div class="task-tabs" role="tablist" aria-label="Tabs công việc">
            <button class="tab-btn active" tabindex="0" type="button" role="tab" aria-selected="true">
              <svg viewBox="0 0 20 20" aria-hidden="true"><path d="M4 10l4 4 8-8"/></svg>
              Đã giao
            </button>
            <button class="tab-btn" tabindex="0" type="button" role="tab" aria-selected="false">
              <svg viewBox="0 0 20 20" aria-hidden="true"><circle cx="9" cy="9" r="7"/><path d="M13 13l4 4"/></svg>
              Được giao
            </button>
          </div>

          <!-- THANH TÌM TASK: chỉ tìm front, không gửi backend -->
          <div class="search-pill" role="search">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <circle cx="11" cy="11" r="7" stroke-width="2"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65" stroke-width="2"></line>
            </svg>
            <input type="text" placeholder="Search" aria-label="Tìm công việc trong trang"/>
          </div>

          <!-- BỘ LỌC TASK: FORM GET -->
          <form id="taskFilterForm" method="GET" action="/tasks">
            <ul class="task-menu" aria-label="Bộ lọc công việc">
              <li>
                <button type="button" aria-haspopup="menu" aria-expanded="false">Bộ lọc công việc</button>
                <ul class="task-sub" role="menu">
                  <li><button name="status" value="all" type="submit" role="menuitem">Tất cả</button></li>
                  <li><button name="status" value="done" type="submit" role="menuitem">Đã hoàn thành</button></li>
                  <li><button name="status" value="doing" type="submit" role="menuitem">Đang làm</button></li>
                  <li><button name="status" value="todo" type="submit" role="menuitem">Chưa nhận</button></li>
                </ul>
              </li>
            </ul>
          </form>
        </div>

        <section class="content-task" aria-live="polite">WorkHub</section>
      </main>

      <!-- RIGHT PANEL STACK -->
      <div class="right-panel-stack" id="rightPanelStack" aria-live="polite">
        <section class="right-panel half" id="calendarPanel" aria-hidden="true" aria-label="Lịch">
          <div class="panel-head">
            <span class="panel-title">
              <svg width="20" height="20" style="vertical-align:middle;margin-right:6px;" fill="none" stroke="currentColor" aria-hidden="true">
                <rect x="3" y="4" width="14" height="14" rx="2" stroke-width="2"/>
                <line x1="7" y1="2" x2="7" y2="6" stroke-width="2"/>
                <line x1="13" y1="2" x2="13" y2="6" stroke-width="2"/>
              </svg>
              Lịch
            </span>
            <button class="close-panel" id="closeCalendarPanel" title="Đóng" type="button" aria-label="Đóng lịch">&times;</button>
          </div>
          <div class="right-section" id="calendarPanelContent"></div>
        </section>

        <section class="right-panel half" id="notifPanel" aria-hidden="true" aria-label="Thông báo">
          <div class="panel-head">
            <span class="panel-title">
              <svg width="20" height="20" style="vertical-align:middle;margin-right:6px;" fill="none" stroke="currentColor" aria-hidden="true">
                <path d="M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9" stroke-width="2"></path>
                <path d="M13.73 21a2 2 0 01-3.46 0" stroke-width="2"></path>
              </svg>
              Thông báo
            </span>
            <button class="close-panel" id="closeNotifPanel" title="Đóng" type="button" aria-label="Đóng thông báo">&times;</button>
          </div>
          <div class="right-section" id="notifPanelContent"></div>
        </section>
      </div>

      <!-- POPUP TẠO NHÓM: FORM POST -->
      <div class="popup-overlay" id="popupGroup" role="dialog" aria-modal="true" aria-labelledby="createGroupTitle">
        <form class="popup-content" id="groupForm" method="POST" action="/groups">
          <!-- Thay bằng token thực của bạn -->
          <input type="hidden" name="_csrf" value="{{csrfToken}}">
          <button class="close-btn" id="closeGroupPopup" type="button" aria-label="Đóng">&times;</button>
          <div class="popup-inner-content" style="flex-direction:column; width:100%;">
            <div>
              <h2 class="popup-title" id="createGroupTitle">Tạo nhóm mới</h2>

              <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px;">
                <label for="groupName" style="font-weight:500;color:#2563eb;">Tên nhóm</label>
                <input id="groupName" name="name" type="text" required placeholder="Nhập tên nhóm" style="padding:10px 13px;border-radius:8px;border:1.5px solid #d1d5db;font-size:15px;background:#f8fafc;">
              </div>

              <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px;">
                <label for="groupLeader" style="font-weight:500;color:#2563eb;">Nhóm trưởng</label>
                <input id="groupLeader" name="leader" type="text" placeholder="Ví dụ: Nguyễn Văn A" style="padding:10px 13px;border-radius:8px;border:1.5px solid #d1d5db;font-size:15px;background:#f8fafc;">
              </div>

              <div style="display:flex;justify-content:flex-end;gap:12px;">
                <button type="button" class="btn" id="cancelGroupBtn">Huỷ</button>
                <button type="submit" class="btn" id="createGroupBtn">Tạo nhóm</button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- POPUP THÔNG TIN TÀI KHOẢN: FORM POST (override PUT) -->
      <div class="popup-overlay" id="popupProfile" style="display:none;align-items:center;justify-content:center;backdrop-filter:blur(2px);z-index:1000;" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
        <form class="popup-content" id="profileForm" style="width:420px;max-width:95vw;" method="POST" action="/profile">
          <input type="hidden" name="_csrf" value="{{csrfToken}}">
          <input type="hidden" name="_method" value="PUT">

          <div class="popup-header" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
            <h2 class="popup-title" id="profileTitle" style="font-size:23px;font-weight:700;color:#8b25eb;letter-spacing:1px;">Thông tin tài khoản</h2>
            <button class="close-btn" id="closeProfileBtn" style="font-size:28px;color:#888;" type="button" aria-label="Đóng">&times;</button>
          </div>

          <div class="profile-img" style="display:flex;align-items:center;justify-content:center;margin-bottom:20px;">
            <img src="" alt="User" style="width:76px;height:76px;border-radius:50%;object-fit:cover;border:2px solid #e0e7ff;box-shadow:0 2px 8px #2563eb22;">
          </div>

          <div class="profile-form" style="display:flex;flex-direction:column;gap:13px;margin-bottom:22px;">
            <div class="form-row" style="display:flex;align-items:center;gap:10px;">
              <label class="form-label" for="username" style="width:110px;font-size:15px;color:#374151;font-weight:500;letter-spacing:.2px;">Tên tài khoản</label>
              <input class="form-input" type="text" name="username" value="Nguyễn Văn A" readonly id="username" style="flex:1;padding:10px 13px;border:1.5px solid #d1d5db;border-radius:8px;font-size:15px;background:#f8fafc;">
            </div>
            <div class="form-row" style="display:flex;align-items:center;gap:10px;">
              <label class="form-label" for="email" style="width:110px;font-size:15px;color:#374151;font-weight:500;letter-spacing:.2px;">Email</label>
              <input class="form-input" type="email" name="email" value="@example.com" readonly id="email" style="flex:1;padding:10px 13px;border:1.5px solid #d1d5db;border-radius:8px;font-size:15px;background:#f8fafc;">
            </div>
            <div class="form-row" style="display:flex;align-items:center;gap:10px;">
              <label class="form-label" for="phone" style="width:110px;font-size:15px;color:#374151;font-weight:500;letter-spacing:.2px;">Số điện thoại</label>
              <input class="form-input" type="tel" name="phone" value="0123456789" readonly id="phone" pattern="^[0-9]{9,11}$" style="flex:1;padding:10px 13px;border:1.5px solid #d1d5db;border-radius:8px;font-size:15px;background:#f8fafc;">
            </div>
            <div class="form-row" style="display:flex;align-items:center;gap:10px;">
              <label class="form-label" for="address" style="width:110px;font-size:15px;color:#374151;font-weight:500;letter-spacing:.2px;">Quê quán</label>
              <input class="form-input" type="text" name="address" value="Hà Nội" readonly id="address" style="flex:1;padding:10px 13px;border:1.5px solid #d1d5db;border-radius:8px;font-size:15px;background:#f8fafc;">
            </div>
            <div class="form-row" style="display:flex;align-items:center;gap:10px;">
              <label class="form-label" for="gender" style="width:110px;font-size:15px;color:#374151;font-weight:500;letter-spacing:.2px;">Giới tính</label>
              <select class="form-input" id="gender" name="gender" disabled style="flex:1;padding:10px 13px;border:1.5px solid #d1d5db;border-radius:8px;font-size:15px;background:#f8fafc;">
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
                <option value="Khác">Khác</option>
              </select>
            </div>
            <div class="form-row" style="display:flex;align-items:center;gap:10px;">
              <label class="form-label" for="dob" style="width:110px;font-size:15px;color:#374151;font-weight:500;letter-spacing:.2px;">Ngày sinh</label>
              <input class="form-input" type="date" name="dob" value="1995-01-01" readonly id="dob" style="flex:1;padding:10px 13px;border:1.5px solid #d1d5db;border-radius:8px;font-size:15px;background:#f8fafc;">
            </div>
          </div>

          <div class="form-actions" style="display:flex;justify-content:center;gap:12px;">
            <button class="btn" type="button" id="editProfileBtn">Sửa</button>
            <button class="btn" type="submit" id="saveProfileBtn" disabled>Xác nhận</button>
          </div>
        </form>
      </div>
    </div>

    <!-- ========== WORKHUB SETTINGS OVERLAY ========== -->
    <div id="whSettings" class="wh-settings" aria-hidden="true" aria-label="Cài đặt WorkHub">
      <div class="wh-wrap">
        <!-- Sidebar -->
        <aside class="wh-side">
          <div class="wh-search"><input placeholder="Tìm kiếm..." aria-label="Tìm trong cài đặt"></div>

          <div class="wh-group">CÀI ĐẶT NGƯỜI DÙNG</div>
          <nav class="wh-nav">
            <button class="wh-nav-item wh-active" data-view="account" type="button">Tài Khoản Của Tôi</button>
            <button class="wh-nav-item" data-view="profile" type="button">Hồ sơ</button>
            <button class="wh-nav-item" data-view="community" type="button">Nội dung & Cộng đồng</button>
            <button class="wh-nav-item" data-view="privacy" type="button">Dữ liệu & Bảo Mật</button>
            <button class="wh-nav-item" data-view="devices" type="button">Thiết bị</button>
            <button class="wh-nav-item" data-view="connections" type="button">Kết Nối</button>
          </nav>

          <div class="wh-group">CÀI ĐẶT ỨNG DỤNG</div>
          <nav class="wh-nav">
            <button class="wh-nav-item" type="button">Hiển thị</button>
            <button class="wh-nav-item" type="button">Trợ năng</button>
            <button class="wh-nav-item" type="button">Giọng nói & Video</button>
            <button class="wh-nav-item" type="button">Trò chuyện</button>
          </nav>
        </aside>

        <!-- Content -->
        <main class="wh-main">
          <header class="wh-topbar">
            <div class="wh-title">Tài Khoản Của Tôi</div>
            <button class="wh-close" id="whClose" title="ESC" type="button">✕</button>
          </header>

          <!-- Banner + avatar -->
          <section class="wh-hero" aria-label="Hồ sơ">
            <div class="wh-hero-bg"></div>
            <div class="wh-hero-row">
              <img class="wh-ava" src="https://i.pravatar.cc/100?img=12" alt="avatar">
              <div class="wh-hero-info">
                <div class="wh-name">Brian</div>
                <div class="wh-badges"><span>#</span><span>⚙️</span></div>
              </div>
              <button class="wh-btn wh-primary" style="margin-left:auto;" type="button">Chỉnh Sửa Hồ Sơ Người Dùng</button>
            </div>
          </section>

          <!-- Thông tin tài khoản -->
          <div class="wh-card">
            <div class="wh-row">
              <div><div class="wh-label">Tên hiển thị</div><div class="wh-value">Brian</div></div>
              <button class="wh-mini" type="button">Chỉnh sửa</button>
            </div>
            <div class="wh-row">
              <div><div class="wh-label">Tên đăng nhập</div><div class="wh-value">beaklynn</div></div>
              <button class="wh-mini" type="button">Chỉnh sửa</button>
            </div>
            <div class="wh-row">
              <div><div class="wh-label">Email</div><div class="wh-value">********@gmail.com <a href="#" class="wh-link">Hiển thị</a></div></div>
              <button class="wh-mini" type="button">Chỉnh sửa</button>
            </div>
            <div class="wh-row">
              <div><div class="wh-label">Số Điện Thoại</div><div class="wh-value">*******4108 <a href="#" class="wh-link">Hiển thị</a></div></div>
              <div style="display:flex;gap:10px;align-items:center;">
                <button class="wh-link wh-danger" style="background:none;border:none;cursor:pointer" type="button">Gỡ bỏ</button>
                <button class="wh-mini" type="button">Chỉnh sửa</button>
              </div>
            </div>
          </div>

          <!-- Tabs -->
          <div class="wh-tabs">
            <button class="wh-tab wh-active" data-tab="security" type="button">Bảo mật</button>
            <button class="wh-tab" data-tab="status" type="button">Trạng thái</button>
          </div>

          <!-- Tab: Bảo mật -->
          <div class="wh-panel wh-show" data-tab="security">
            <h3 class="wh-section">Mật Khẩu và Xác Thực</h3>
            <div class="wh-card">
              <div class="wh-row wh-between">
                <div><div class="wh-t">Đổi Mật Khẩu</div><div class="wh-sub">Cập nhật mật khẩu để bảo vệ tài khoản.</div></div>
                <button class="wh-btn wh-primary" type="button">Đổi Mật Khẩu</button>
              </div>
              <hr style="border:0;border-top:1px solid #374151">
              <div class="wh-row wh-between">
                <div><div class="wh-t">Ứng Dụng Xác Thực</div><div class="wh-sub">Thêm lớp bảo mật bổ sung khi đăng nhập.</div></div>
                <button class="wh-btn wh-primary" type="button">Bật Ứng Dụng Xác Thực</button>
              </div>
              <hr style="border:0;border-top:1px solid #374151">
              <div class="wh-row wh-between">
                <div><div class="wh-t">Mã bảo mật</div><div class="wh-sub">Tạo mã dự phòng để đăng nhập an toàn.</div></div>
                <button class="wh-btn wh-secondary" type="button">Đăng ký Mã Bảo Mật</button>
              </div>
            </div>

            <div class="wh-card wh-danger-zone">
              <h4 class="wh-section">Ngừng Sử Dụng Tài Khoản</h4>
              <div class="wh-row" style="gap:10px;">
                <button class="wh-btn wh-danger" type="button">Vô Hiệu Hóa Tài Khoản</button>
                <button class="wh-btn wh-danger wh-outline" type="button">Xóa Tài Khoản</button>
              </div>
            </div>
          </div>

          <!-- Tab: Trạng thái -->
          <div class="wh-panel" data-tab="status">
            <div class="wh-card">
              <div class="wh-row wh-between">
                <div><div class="wh-t">Trạng thái tài khoản</div><div class="wh-sub">Tài khoản hoạt động bình thường.</div></div>
                <span class="wh-pill-ok">Đang hoạt động</span>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <!-- ========== /WORKHUB SETTINGS OVERLAY ========== -->

  <script>
    // ================== DỮ LIỆU DEMO (có thể xoá khi nối backend) ==================
    // Mẫu danh sách nhóm (demo)
    let groups = [
      { id: 1, name: "Nhóm A", leader: "Nguyễn Văn A" },
      { id: 2, name: "Nhóm B", leader: "Trần Thị B" }
    ];

    // ================== TẠO NHÓM POPUP + RENDER LIST ==================
    const btnAddGroup = document.getElementById('btnAddGroup');
    const popupGroup   = document.getElementById('popupGroup');
    const closeGroupPopup = document.getElementById('closeGroupPopup');
    const cancelGroupBtn  = document.getElementById('cancelGroupBtn');
    const groupForm  = document.getElementById('groupForm');
    const groupList  = document.getElementById('groupList');
    const groupSearchInput = document.querySelector('#groupSearchForm #q');

    function renderGroups(data = groups){
      groupList.innerHTML = data.map(g => `
        <div style="padding:10px 14px;border-bottom:1px solid #e5e7eb;cursor:pointer;" role="listitem">
          <div style="font-weight:600;color:#524041;">${g.name}</div>
          <div style="font-size:13px;color:#64748b;opacity:.85;">Nhóm trưởng: ${g.leader || ''}</div>
        </div>
      `).join('');
    }
    renderGroups();

    // Search nhóm: PE — nếu backend có /groups?q=... trả JSON thì dùng fetch; nếu không thì form GET vẫn hoạt động.
    document.getElementById('groupSearchForm').addEventListener('submit', (e)=> e.preventDefault());
    groupSearchInput.addEventListener('input', debounce(async (e)=>{
      const q = e.target.value.trim();
      try{
        const res = await fetch(`/groups?q=${encodeURIComponent(q)}`, { headers: { Accept: 'application/json' }});
        if(res.ok){
          const data = await res.json(); // [{id,name,leader}]
          renderGroups(data);
          return;
        }
      }catch(_){} // ignore
      // fallback filter local demo
      const filtered = groups.filter(g => g.name.toLowerCase().includes(q.toLowerCase()));
      renderGroups(filtered);
    }, 250));

    // Mở/đóng popup tạo nhóm
    btnAddGroup.onclick = () => {
      popupGroup.classList.add('active');
      groupForm.reset();
      document.getElementById('groupName').focus();
    };
    function hideGroupPopup(){ popupGroup.classList.remove('active'); }
    closeGroupPopup.onclick = hideGroupPopup;
    cancelGroupBtn.onclick  = hideGroupPopup;
    popupGroup.onclick = (e) => { if(e.target === popupGroup) hideGroupPopup(); };

    // Submit tạo nhóm — Progressive Enhancement: thử AJAX, nếu lỗi sẽ để trình duyệt submit bình thường
    groupForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const form = e.currentTarget;
      const data = new FormData(form);
      try{
        const res = await fetch(form.action, { method: form.method, body: data, headers: { Accept: 'application/json' }});
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const created = await res.json(); // {id,name,leader}
        // cập nhật UI demo
        groups.unshift({ id: created.id ?? Date.now(), name: created.name ?? data.get('name'), leader: created.leader ?? data.get('leader') });
        renderGroups(groups);
        hideGroupPopup();
        form.reset();
      }catch(err){
        // Fallback: bỏ preventDefault để cho submit thật (reload trang)
        form.removeEventListener('submit', arguments.callee);
        form.submit();
      }
    });

    // ================== THEME ==================
    const THEME_KEY = "workhub-theme";
    const themeBtn = document.getElementById("btnTheme");
    const themeIcon = document.getElementById("themeIcon");
    function getPreferredTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      if(saved === "light" || saved === "dark") return saved;
      return (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light";
    }
    function applyTheme(t){
      document.documentElement.setAttribute("data-theme", t);
      themeBtn.title = t === "dark" ? "Chuyển sang sáng" : "Chuyển sang tối";
      themeBtn.setAttribute("aria-pressed", t === "dark");
      themeIcon.innerHTML = t === "dark"
        ? `<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke-width="2"/>`
        : `<circle cx="12" cy="12" r="5" stroke-width="2"/>
           <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke-width="2"/>`;
    }
    function toggleTheme(){
      const current = document.documentElement.getAttribute("data-theme") || "light";
      const next = current === "dark" ? "light" : "dark";
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    }
    applyTheme(getPreferredTheme());
    themeBtn.addEventListener("click", toggleTheme);

    // ================== TABS ==================
    document.querySelectorAll(".tab-btn").forEach((btn)=>{
      btn.addEventListener("click",()=>{
        document.querySelectorAll(".tab-btn").forEach(b=>{ b.classList.remove("active"); b.setAttribute('aria-selected','false'); });
        btn.classList.add("active");
        btn.setAttribute('aria-selected','true');
      });
    });

    // ================== RIGHT PANELS ==================
    const notifPanel = document.getElementById("notifPanel");
    const notifPanelContent = document.getElementById("notifPanelContent");
    const calendarPanel = document.getElementById("calendarPanel");
    const calendarPanelContent = document.getElementById("calendarPanelContent");
    const closeNotifPanel = document.getElementById("closeNotifPanel");
    const closeCalendarPanel = document.getElementById("closeCalendarPanel");
    const btnNotif = document.getElementById("btnNotif");
    const btnCalendar = document.getElementById("btnCalendar");

    let panelOrder = [];
    function showPanel(panel){
      const el = panel === 'notif' ? notifPanel : calendarPanel;
      const btn = panel === 'notif' ? btnNotif : btnCalendar;
      const other = panel === 'notif' ? calendarPanel : notifPanel;
      const otherBtn = panel === 'notif' ? btnCalendar : btnNotif;

      // toggle behavior
      if(panelOrder.includes(panel)){ closePanel(panel); return; }
      panelOrder = [panel, ...panelOrder]; if(panelOrder.length>2) panelOrder = panelOrder.slice(0,2);

      notifPanel.classList.remove("top","bottom","show");
      calendarPanel.classList.remove("top","bottom","show");
      notifPanel.setAttribute('aria-hidden','true');
      calendarPanel.setAttribute('aria-hidden','true');
      btnNotif.setAttribute('aria-expanded','false');
      btnCalendar.setAttribute('aria-expanded','false');

      function renderNotif(){
        notifPanelContent.innerHTML = `
          <div class="notif-list">
            <div class="notif-item"><div class="notif-dot"></div>Nội dung thông báo</div>
            <div class="notif-item"><div class="notif-dot"></div>Nội dung thông báo</div>
            <div class="notif-item"><div class="notif-dot"></div>Nội dung thông báo</div>
            <div class="notif-item"><div class="notif-dot"></div>Nội dung thông báo</div>
          </div>`;
      }
      function renderCalendar(){
        calendarPanelContent.innerHTML = `
          <div class="calendar-card" id="calendarCard">
            <div class="calendar-head">
              <div>
                <div class="calendar-title" id="titleDay">Mon, Sep 29</div>
                <div class="calendar-sub" id="subMonth">SEPTEMBER 2025</div>
              </div>
              <div>
                <button class="btn" id="prevMth" type="button" aria-label="Tháng trước">◀</button>
                <button class="btn" id="nextMth" type="button" aria-label="Tháng sau">▶</button>
              </div>
            </div>
            <div class="calendar-grid" id="calGrid" aria-label="Lưới lịch"></div>
          </div>`;
        setTimeout(initCalendar,0);
      }

      if(panelOrder.length===1){
        if(panelOrder[0]==="notif"){ notifPanel.classList.add("show","top"); renderNotif(); btnNotif.setAttribute('aria-expanded','true'); notifPanel.setAttribute('aria-hidden','false'); }
        else { calendarPanel.classList.add("show","top"); renderCalendar(); btnCalendar.setAttribute('aria-expanded','true'); calendarPanel.setAttribute('aria-hidden','false'); }
      }else{
        if(panelOrder[0]==="notif" && panelOrder[1]==="calendar"){
          notifPanel.classList.add("show","top"); calendarPanel.classList.add("show","bottom"); renderNotif();
          btnNotif.setAttribute('aria-expanded','true'); notifPanel.setAttribute('aria-hidden','false');
          calendarPanel.setAttribute('aria-hidden','false');
        }else{
          calendarPanel.classList.add("show","top"); notifPanel.classList.add("show","bottom"); renderCalendar();
          btnCalendar.setAttribute('aria-expanded','true'); calendarPanel.setAttribute('aria-hidden','false');
          notifPanel.setAttribute('aria-hidden','false');
        }
      }
    }
    function closePanel(panel){
      panelOrder = panelOrder.filter(p=>p!==panel);
      notifPanel.classList.remove("top","bottom","show");
      calendarPanel.classList.remove("top","bottom","show");
      notifPanel.setAttribute('aria-hidden','true');
      calendarPanel.setAttribute('aria-hidden','true');
      if(panelOrder.length===1){
        if(panelOrder[0]==="notif"){ notifPanel.classList.add("show","top"); notifPanel.setAttribute('aria-hidden','false'); btnNotif.setAttribute('aria-expanded','true'); }
        else{ calendarPanel.classList.add("show","top"); calendarPanel.setAttribute('aria-hidden','false'); btnCalendar.setAttribute('aria-expanded','true'); }
      }else{
        btnNotif.setAttribute('aria-expanded','false');
        btnCalendar.setAttribute('aria-expanded','false');
      }
    }
    btnNotif.onclick = () => showPanel("notif");
    btnCalendar.onclick = () => showPanel("calendar");
    closeNotifPanel.onclick = () => closePanel("notif");
    closeCalendarPanel.onclick = () => closePanel("calendar");

    document.addEventListener("mousedown",(e)=>{
      if(notifPanel.classList.contains("show") && !notifPanel.contains(e.target) && !btnNotif.contains(e.target)) closePanel("notif");
      if(calendarPanel.classList.contains("show") && !calendarPanel.contains(e.target) && !btnCalendar.contains(e.target)) closePanel("calendar");
    });

    function initCalendar(){
      const calGrid  = document.getElementById("calGrid");
      const titleDay = document.getElementById("titleDay");
      const subMonth = document.getElementById("subMonth");
      const prevMth  = document.getElementById("prevMth");
      const nextMth  = document.getElementById("nextMth");
      let view = new Date();

      function headText(d){
        const w = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];
        const m = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()];
        return `${w}, ${m} ${String(d.getDate()).padStart(2,"0")}`;
      }
      function buildCalendar(date){
        const y = date.getFullYear(), m = date.getMonth();
        titleDay.textContent = headText(new Date());
        subMonth.textContent = new Intl.DateTimeFormat("en-US",{month:"long",year:"numeric"}).format(new Date(y,m,1)).toUpperCase();

        const first = new Date(y,m,1);
        const start = (first.getDay()+6)%7; // Monday first
        const days  = new Date(y,m+1,0).getDate();
        const prevDays = new Date(y,m,0).getDate();

        const parts = [];
        ["M","T","W","T","F","S","S"].forEach(d=>parts.push(`<div class="dow">${d}</div>`));
        for(let i=0;i<42;i++){
          let label, cls="cell";
          if(i<start){ label = prevDays-start+i+1; cls+=" faded"; }
          else if(i<start+days){ label = i-start+1; }
          else{ label = i-(start+days)+1; cls+=" faded"; }

          const today = new Date();
          if(y===today.getFullYear() && m===today.getMonth() && label===today.getDate() && !cls.includes("faded")) cls+=" today";
          parts.push(`<div class="${cls}" role="gridcell" aria-selected="${cls.includes('today')?'true':'false'}">${label}</div>`);
        }
        calGrid.innerHTML = parts.join("");
      }
      prevMth.addEventListener("click",()=>{ view.setMonth(view.getMonth()-1); buildCalendar(view); });
      nextMth.addEventListener("click",()=>{ view.setMonth(view.getMonth()+1); buildCalendar(view); });
      buildCalendar(view);
    }

    // ================== ACCOUNT MENU & PROFILE POPUP ==================
    const openProfile = document.getElementById('openProfile');
    const userMenu = document.getElementById('userMenu');
    openProfile.addEventListener('click',function(e){
      e.stopPropagation();
      const show = userMenu.style.display !== 'block';
      userMenu.style.display = show ? 'block' : 'none';
      openProfile.setAttribute('aria-expanded', show ? 'true' : 'false');
    });
    document.addEventListener('mousedown',function(e){
      if(!openProfile.contains(e.target)){ userMenu.style.display='none'; openProfile.setAttribute('aria-expanded','false');}
    });
    document.getElementById('Profile').onclick = function(){
      document.getElementById('popupProfile').style.display='flex';
      userMenu.style.display='none';
    };
    document.getElementById('Logout').onclick = function(){ alert('Đăng xuất'); userMenu.style.display='none'; };

    const popupProfile = document.getElementById('popupProfile');
    const closeProfileBtn = document.getElementById('closeProfileBtn');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    const genderSelect = document.getElementById('gender');
    const profileFormInputs = [document.getElementById('email'),document.getElementById('phone'),document.getElementById('address'),genderSelect,document.getElementById('dob')];
    const usernameInput = document.getElementById('username');
    let isEditingProfile = false;

    function closeProfilePopup(){
      popupProfile.style.display='none';
      setProfileReadOnly(true);
      isEditingProfile=false;
      saveProfileBtn.disabled=true;
    }
    closeProfileBtn.onclick = closeProfilePopup;
    popupProfile.onclick = function(e){ if(e.target===popupProfile) closeProfilePopup(); };
    editProfileBtn.onclick = function(){
      isEditingProfile=true;
      setProfileReadOnly(false);
      saveProfileBtn.disabled=false;
      document.getElementById('email').focus();
    };

    function setProfileReadOnly(readonly){
      profileFormInputs.forEach(input=>{
        if(input.tagName==='SELECT'){ input.disabled=readonly; }
        else{ input.readOnly=readonly; }
      });
      usernameInput.readOnly = true;
    }

    // Submit profile (PE: AJAX -> fallback)
    const profileForm = document.getElementById('profileForm');
    profileForm.addEventListener('submit', async (e)=>{
      // Nếu form đang readonly (chưa bấm "Sửa"), không cho submit
      if(!isEditingProfile){
        e.preventDefault();
        return;
      }
      e.preventDefault();
      const data = new FormData(profileForm);
      try{
        const res = await fetch(profileForm.action, { method: profileForm.method, body: data, headers: { Accept: 'application/json' }});
        if(!res.ok) throw new Error('HTTP '+res.status);
        alert('Thông tin đã được lưu!');
        setProfileReadOnly(true);
        isEditingProfile=false;
        saveProfileBtn.disabled=true;
      }catch(err){
        profileForm.removeEventListener('submit', arguments.callee);
        profileForm.submit();
      }
    });

    // ================== WORKHUB SETTINGS (mở/đóng) ==================
    const whOverlay = document.getElementById('whSettings');
    const whBtnOpen = document.getElementById('OpenSettings');
    const whBtnClose = document.getElementById('whClose');

    if (whBtnOpen) {
      whBtnOpen.addEventListener('click', () => {
        whOverlay.style.display = 'block';
        whOverlay.setAttribute('aria-hidden','false');
        if (userMenu) userMenu.style.display = 'none';
      });
    }
    if (whBtnClose) {
      whBtnClose.addEventListener('click', () => {
        whOverlay.style.display = 'none';
        whOverlay.setAttribute('aria-hidden','true');
      });
    }
    // ESC to close
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && whOverlay.style.display === 'block'){
        whOverlay.style.display = 'none';
        whOverlay.setAttribute('aria-hidden','true');
      }
    });

    // Tabs trong trang cài đặt
    document.querySelectorAll('.wh-tab').forEach(tab=>{
      tab.addEventListener('click',()=>{
        document.querySelectorAll('.wh-tab').forEach(t=>t.classList.remove('wh-active'));
        document.querySelectorAll('.wh-panel').forEach(p=>p.classList.remove('wh-show'));
        tab.classList.add('wh-active');
        document.querySelector(`.wh-panel[data-tab="${tab.dataset.tab}"]`)?.classList.add('wh-show');
      });
    });

    // Sidebar highlight
    document.querySelectorAll('.wh-nav-item').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.wh-nav-item').forEach(b=>b.classList.remove('wh-active'));
        btn.classList.add('wh-active');
      });
    });

    // Utility: debounce
    function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }
  </script>
</body>
</html>
